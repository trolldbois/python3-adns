
# good example https://github.com/thenewguy/django-randomfields/blob/master/.github/workflows/sdist.yml
name: python3-adns-linux

on: [push, pull_request]


jobs:
  check-package-build:
    name: Build & inspect our package.
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          # get all history and tags for setuptools_scm to find the right version
          fetch-depth: 0
      - name: Install build dependencies
        run: |
          pip install setuptools setuptools_scm wheel build
      - name: Install Adns
        run: |
          sudo apt install -y libadns1-dev
#
#      - name: Build package wheel
#        run: python -m build -w
      - name: Build package sdist
        run: python setup.py sdist
      - name: Upload built artifacts.
        uses: actions/upload-artifact@v3
        # By default, the artifacts and log files generated by workflows are retained for 90 days before they are automatically deleted.
        with:
          name: Packages
          path: ./dist/*
#      - uses: hynek/build-and-inspect-python-package@v1
#        id: build-package
      # packages are uploaded to Packages

  test:
    needs: check-package-build
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # os: [ubuntu-latest, macos-latest, windows-latest]
        # python-version: [ 3.5, 3.6, 3.7, 3.8, 3.9 ]
         os: [ubuntu-latest]
        #, macos-latest, windows-latest]
         python-version: [ '3.7', '3.8', '3.9', '3.10', '3.11', '3.12' ]

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip 
        pip install setuptools setuptools_scm
# coveralls coverage[toml]
    - uses: actions/download-artifact@v3
      with:
        name: Packages
        path: ~/packages/
    - name: Install the package that was built
      run: |
        pip install ~/packages/adns*.tar.gz
#    - name: Run tests with Unittest and coverage
#      run: |
#        coverage run --source=adns -m unittest test
#    - name: Coveralls
#      uses: coverallsapp/github-action@v2
#      with:
#        parallel: true
#        flag-name: run-${{ join(matrix.*, ' - ') }}

#  coveralls_finish:
#    needs: test
#    runs-on: ubuntu-latest
#    steps:
#    - name: Coveralls Finished
#      uses: coverallsapp/github-action@v2
#      with:
#        parallel-finished: true

